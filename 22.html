<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Sistem Inventaris DISPORA - Multi Role</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .nav-link {
            color: rgba(255,255,255,0.8) !important;
            transition: all 0.3s;
        }
        .nav-link:hover, .nav-link.active {
            color: white !important;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        .card {
            border: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-radius: 12px;
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .role-badge {
            font-size: 0.8rem;
            padding: 4px 12px;
            border-radius: 20px;
        }
        .role-admin { background: #dc3545; }
        .role-petugas { background: #28a745; }
        .role-pimpinan { background: #007bff; }
        .login-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .permission-denied {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-3 col-lg-2 px-0">
                    <div class="sidebar px-3 py-4">
                        <div class="text-center mb-4">
                            <h5 class="text-white">DISPORA Inventory</h5>
                            <div id="userInfo" class="mt-2"></div>
                        </div>
                        <nav class="nav flex-column" id="sidebarNav">
                            </nav>
                        <div class="mt-auto pt-4">
                            <button class="btn btn-outline-light btn-sm w-100" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-md-9 col-lg-10">
                    <div class="p-4">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 id="pageTitle">Dashboard</h2>
                            <div id="userRole"></div>
                        </div>

                        <div id="contentArea">
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Data Management
        let currentUser = null;
        let inventoryData = JSON.parse(localStorage.getItem('inventoryData')) || [];
        let transactionData = JSON.parse(localStorage.getItem('transactionData')) || [];
        let userData = JSON.parse(localStorage.getItem('userData')) || [];

        // User accounts for demo
        const demoUsers = [
            { username: 'admin', password: 'admin123', role: 'admin', name: 'Administrator' },
            { username: 'petugas', password: 'petugas123', role: 'petugas', name: 'Petugas Inventaris' },
            { username: 'pimpinan', password: 'pimpinan123', role: 'pimpinan', name: 'Pimpinan DISPORA' }
        ];

        // Role permissions
        const permissions = {
            admin: {
                dashboard: true,
                dataBarang: { view: true, add: true, edit: true, delete: true },
                transaksi: { view: true, add: true, edit: true, delete: true },
                laporan: { view: true, export: true },
                userManagement: { view: true, add: true, edit: true, delete: true }
            },
            petugas: {
                dashboard: true,
                dataBarang: { view: true, add: true, edit: true, delete: false },
                transaksi: { view: true, add: true, edit: true, delete: false },
                laporan: { view: true, export: false },
                userManagement: { view: false, add: false, edit: false, delete: false }
            },
            pimpinan: {
                dashboard: true,
                dataBarang: { view: true, add: false, edit: false, delete: false },
                transaksi: { view: true, add: false, edit: false, delete: false },
                laporan: { view: true, export: true },
                userManagement: { view: true, add: false, edit: false, delete: false }
            }
        };

        // Initialize sample data
        function initSampleData() {
            if (inventoryData.length === 0) {
                inventoryData = [
                    {
                        kode: 'OR001',
                        nama: 'Bola Sepak',
                        kategori: 'Olahraga',
                        kondisi: 'Baik',
                        jumlah: 10,
                        harga: 150000,
                        lokasi: 'Gudang Olahraga',
                        keterangan: 'Bola sepak untuk kegiatan olahraga',
                        tanggal: '2024-01-15'
                    },
                    {
                        kode: 'EL001',
                        nama: 'Komputer Desktop',
                        kategori: 'Elektronik',
                        kondisi: 'Baik',
                        jumlah: 5,
                        harga: 8000000,
                        lokasi: 'Ruang Sekretariat',
                        keterangan: 'Komputer untuk administrasi',
                        tanggal: '2024-01-20'
                    }
                ];
                localStorage.setItem('inventoryData', JSON.stringify(inventoryData));
            }
        }

        // Login function
        function login(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;

            const user = demoUsers.find(u => 
                u.username === username && 
                u.password === password && 
                u.role === role
            );

            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showMainScreen();
            } else {
                alert('Username, password, atau role tidak valid!');
            }
        }

        // Show main screen
        function showMainScreen() {
            document.getElementById('loginScreen').classList.add('d-none');
            document.getElementById('mainScreen').classList.remove('d-none');
            
            updateUserInfo();
            buildNavigation();
            showDashboard();
        }

        // Update user info display
        function updateUserInfo() {
            const userInfo = document.getElementById('userInfo');
            const userRole = document.getElementById('userRole');
            
            userInfo.innerHTML = `
                <div class="text-white-50 small">${currentUser.name}</div>
                <span class="role-badge role-${currentUser.role}">${currentUser.role.toUpperCase()}</span>
            `;
            
            userRole.innerHTML = `
                <span class="role-badge role-${currentUser.role}">${currentUser.role.toUpperCase()}</span>
            `;
        }

        // Build navigation based on role
        function buildNavigation() {
            const nav = document.getElementById('sidebarNav');
            const userPermissions = permissions[currentUser.role];
            
            let navHTML = '';
            
            // Dashboard
            if (userPermissions.dashboard) {
                navHTML += `
                    <a class="nav-link active" href="#" onclick="showDashboard()">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                    </a>
                `;
            }
            
            // Data Barang
            if (userPermissions.dataBarang.view) {
                navHTML += `
                    <a class="nav-link" href="#" onclick="showDataBarang()">
                        <i class="fas fa-boxes me-2"></i>Data Barang
                    </a>
                `;
            }
            
            // Transaksi
            if (userPermissions.transaksi.view) {
                navHTML += `
                    <a class="nav-link" href="#" onclick="showTransaksi()">
                        <i class="fas fa-exchange-alt me-2"></i>Transaksi
                    </a>
                `;
            }
            
            // Laporan
            if (userPermissions.laporan.view) {
                navHTML += `
                    <a class="nav-link" href="#" onclick="showLaporan()">
                        <i class="fas fa-chart-bar me-2"></i>Laporan
                    </a>
                `;
            }
            
            // User Management (Admin only)
            if (userPermissions.userManagement.view) {
                navHTML += `
                    <a class="nav-link" href="#" onclick="showUserManagement()">
                        <i class="fas fa-users me-2"></i>Kelola User
                    </a>
                `;
            }
            
            nav.innerHTML = navHTML;
        }

        // Check permission
        function hasPermission(module, action) {
            return permissions[currentUser.role][module] && 
                   permissions[currentUser.role][module][action];
        }

        // Show dashboard
        function showDashboard() {
            document.getElementById('pageTitle').textContent = 'Dashboard';
            setActiveNav(0);
            
            const totalBarang = inventoryData.reduce((sum, item) => sum + item.jumlah, 0);
            const barangBaik = inventoryData.filter(item => item.kondisi === 'Baik').reduce((sum, item) => sum + item.jumlah, 0);
            const barangRusak = inventoryData.filter(item => item.kondisi === 'Rusak').reduce((sum, item) => sum + item.jumlah, 0);
            const nilaiTotal = inventoryData.reduce((sum, item) => sum + (item.jumlah * item.harga), 0);
            
            document.getElementById('contentArea').innerHTML = `
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="card-body text-center">
                                <i class="fas fa-boxes fa-2x mb-2"></i>
                                <h4>${totalBarang}</h4>
                                <p class="mb-0">Total Barang</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="card-body text-center">
                                <i class="fas fa-check-circle fa-2x mb-2"></i>
                                <h4>${barangBaik}</h4>
                                <p class="mb-0">Kondisi Baik</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="card-body text-center">
                                <i class="fas fa-wrench fa-2x mb-2"></i>
                                <h4>${barangRusak}</h4>
                                <p class="mb-0">Perlu Perbaikan</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="card-body text-center">
                                <i class="fas fa-money-bill-wave fa-2x mb-2"></i>
                                <h4>${formatRupiah(nilaiTotal)}</h4>
                                <p class="mb-0">Nilai Total</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-table me-2"></i>Barang Terbaru</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Kode</th>
                                        <th>Nama Barang</th>
                                        <th>Kategori</th>
                                        <th>Kondisi</th>
                                        <th>Tanggal Input</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${inventoryData.slice(-5).reverse().map(item => `
                                        <tr>
                                            <td>${item.kode}</td>
                                            <td>${item.nama}</td>
                                            <td>${item.kategori}</td>
                                            <td><span class="badge bg-${item.kondisi === 'Baik' ? 'success' : 'warning'}">${item.kondisi}</span></td>
                                            <td>${item.tanggal}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // Show data barang
        function showDataBarang() {
            if (!hasPermission('dataBarang', 'view')) {
                showPermissionDenied();
                return;
            }
            
            document.getElementById('pageTitle').textContent = 'Data Barang';
            setActiveNav(1);
            
            const canAdd = hasPermission('dataBarang', 'add');
            const canEdit = hasPermission('dataBarang', 'edit');
            const canDelete = hasPermission('dataBarang', 'delete');
            
            document.getElementById('contentArea').innerHTML = `
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-boxes me-2"></i>Daftar Barang</h5>
                        ${canAdd ? '<button class="btn btn-primary btn-sm" onclick="showAddBarangForm()"><i class="fas fa-plus me-1"></i>Tambah Barang</button>' : ''}
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Kode</th>
                                        <th>Nama</th>
                                        <th>Kategori</th>
                                        <th>Kondisi</th>
                                        <th>Jumlah</th>
                                        <th>Harga</th>
                                        <th>Lokasi</th>
                                        ${(canEdit || canDelete) ? '<th>Aksi</th>' : ''}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${inventoryData.map(item => `
                                        <tr>
                                            <td>${item.kode}</td>
                                            <td>${item.nama}</td>
                                            <td>${item.kategori}</td>
                                            <td><span class="badge bg-${item.kondisi === 'Baik' ? 'success' : 'warning'}">${item.kondisi}</span></td>
                                            <td>${item.jumlah}</td>
                                            <td>${formatRupiah(item.harga)}</td>
                                            <td>${item.lokasi}</td>
                                            ${(canEdit || canDelete) ? `
                                                <td>
                                                    ${canEdit ? `<button class="btn btn-sm btn-outline-primary me-1" onclick="editBarang('${item.kode}')"><i class="fas fa-edit"></i></button>` : ''}
                                                    ${canDelete ? `<button class="btn btn-sm btn-outline-danger" onclick="deleteBarang('${item.kode}')"><i class="fas fa-trash"></i></button>` : ''}
                                                </td>
                                            ` : ''}
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // Show transaksi
        function showTransaksi() {
            if (!hasPermission('transaksi', 'view')) {
                showPermissionDenied();
                return;
            }
            
            document.getElementById('pageTitle').textContent = 'Transaksi';
            setActiveNav(2);
            
            const canAdd = hasPermission('transaksi', 'add');
            
            document.getElementById('contentArea').innerHTML = `
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-exchange-alt me-2"></i>Riwayat Transaksi</h5>
                        ${canAdd ? '<button class="btn btn-primary btn-sm" onclick="showAddTransaksiForm()"><i class="fas fa-plus me-1"></i>Tambah Transaksi</button>' : ''}
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Jenis</th>
                                        <th>Kode Barang</th>
                                        <th>Nama Barang</th>
                                        <th>Jumlah</th>
                                        <th>Keterangan</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${transactionData.map(trans => `
                                        <tr>
                                            <td>${trans.tanggal}</td>
                                            <td><span class="badge bg-${trans.jenis === 'masuk' ? 'success' : 'danger'}">${trans.jenis.toUpperCase()}</span></td>
                                            <td>${trans.kodeBarang}</td>
                                            <td>${trans.namaBarang}</td>
                                            <td>${trans.jumlah}</td>
                                            <td>${trans.keterangan}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // Show laporan
        function showLaporan() {
            if (!hasPermission('laporan', 'view')) {
                showPermissionDenied();
                return;
            }
            
            document.getElementById('pageTitle').textContent = 'Laporan';
            setActiveNav(3);
            
            const canExport = hasPermission('laporan', 'export');
            
            document.getElementById('contentArea').innerHTML = `
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Laporan Inventaris</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Ringkasan Barang per Kategori:</h6>
                                        <ul class="list-group list-group-flush">
                                            ${getKategoriSummary().map(cat => `
                                                <li class="list-group-item d-flex justify-content-between">
                                                    <span>${cat.kategori}</span>
                                                    <span class="badge bg-primary">${cat.jumlah}</span>
                                                </li>
                                            `).join('')}
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Kondisi Barang:</h6>
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item d-flex justify-content-between">
                                                <span>Baik</span>
                                                <span class="badge bg-success">${inventoryData.filter(item => item.kondisi === 'Baik').reduce((sum, item) => sum + item.jumlah, 0)}</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between">
                                                <span>Rusak</span>
                                                <span class="badge bg-warning">${inventoryData.filter(item => item.kondisi === 'Rusak').reduce((sum, item) => sum + item.jumlah, 0)}</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-download me-2"></i>Export Laporan</h5>
                            </div>
                            <div class="card-body">
                                ${canExport ? `
                                    <button class="btn btn-success btn-sm w-100 mb-2" onclick="exportToExcel()">
                                        <i class="fas fa-file-excel me-1"></i>Export to Excel
                                    </button>
                                    <button class="btn btn-danger btn-sm w-100" onclick="exportToPDF()">
                                        <i class="fas fa-file-pdf me-1"></i>Export to PDF
                                    </button>
                                ` : `
                                    <div class="permission-denied">
                                        <i class="fas fa-lock me-2"></i>
                                        Anda tidak memiliki izin untuk export laporan.
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Show user management (Admin only)
        function showUserManagement() {
            if (!hasPermission('userManagement', 'view')) {
                showPermissionDenied();
                return;
            }
            
            document.getElementById('pageTitle').textContent = 'Kelola User';
            setActiveNav(4);
            
            document.getElementById('contentArea').innerHTML = `
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-users me-2"></i>Daftar User</h5>
                        <button class="btn btn-primary btn-sm" onclick="showAddUserForm()">
                            <i class="fas fa-plus me-1"></i>Tambah User
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Nama</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${demoUsers.map(user => `
                                        <tr>
                                            <td>${user.username}</td>
                                            <td>${user.name}</td>
                                            <td><span class="role-badge role-${user.role}">${user.role.toUpperCase()}</span></td>
                                            <td><span class="badge bg-success">Aktif</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary me-1">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // Show permission denied message
        function showPermissionDenied() {
            document.getElementById('contentArea').innerHTML = `
                <div class="permission-denied text-center">
                    <i class="fas fa-lock fa-3x mb-3"></i>
                    <h4>Akses Ditolak</h4>
                    <p>Anda tidak memiliki izin untuk mengakses halaman ini.</p>
                </div>
            `;
        }

        // Utility functions
        function formatRupiah(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function getKategoriSummary() {
            const summary = {};
            inventoryData.forEach(item => {
                if (summary[item.kategori]) {
                    summary[item.kategori] += item.jumlah;
                } else {
                    summary[item.kategori] = item.jumlah;
                }
            });
            
            return Object.keys(summary).map(kategori => ({
                kategori: kategori,
                jumlah: summary[kategori]
            }));
        }

        function setActiveNav(index) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelectorAll('.nav-link')[index].classList.add('active');
        }

        // Logout function
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('mainScreen').classList.add('d-none');
            document.getElementById('loginScreen').classList.remove('d-none');
            document.getElementById('loginForm').reset();
        }

        // Placeholder functions for forms and actions
        function showAddBarangForm() {
            alert('Form tambah barang akan ditampilkan di sini');
        }

        function editBarang(kode) {
            alert(`Edit barang dengan kode: ${kode}`);
        }

        function deleteBarang(kode) {
            if (confirm(`Hapus barang